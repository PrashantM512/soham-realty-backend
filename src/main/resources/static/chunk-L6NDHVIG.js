import{D as h,H as i,K as l,P as y,_b as u,ac as f,f as c,i as a}from"./chunk-SRQFOZRN.js";import{c as s}from"./chunk-7CGTOI24.js";var g=class o{constructor(e){this.http=e}apiUrl="http://localhost:8080/api/properties";featuredPropertiesCache$=new c([]);propertyCache=new Map;cacheExpiry=new Map;CACHE_DURATION=5*60*1e3;getAllProperties(e){let t=new u;return console.log("Sending search params to backend:",e),e.search&&(t=t.set("search",e.search)),e.location&&(t=t.set("location",e.location)),e.priceRange&&(t=t.set("priceRange",e.priceRange)),e.propertyType&&(t=t.set("propertyType",e.propertyType)),e.bedrooms&&(t=t.set("bedrooms",e.bedrooms)),e.sortBy&&(t=t.set("sortBy",e.sortBy)),e.page&&(t=t.set("page",e.page.toString())),e.limit&&(t=t.set("limit",e.limit.toString())),this.http.get(this.apiUrl,{params:t})}getFeaturedProperties(){let e="featured_properties",t=Date.now();return this.cacheExpiry.has(e)&&this.cacheExpiry.get(e)>t&&this.featuredPropertiesCache$.value.length>0?a({success:!0,data:this.featuredPropertiesCache$.value,message:"Success"}):this.http.get(`${this.apiUrl}/featured`).pipe(i(r=>{this.featuredPropertiesCache$.next(r.data),this.cacheExpiry.set(e,t+this.CACHE_DURATION)}),h(1))}getPropertyById(e){return this.propertyCache.has(e)?a({success:!0,data:this.propertyCache.get(e),message:"Success"}):this.http.get(`${this.apiUrl}/${e}`).pipe(i(t=>{this.propertyCache.set(e,t.data)}))}createProperty(e){let p=e,{images:t}=p,r=s(p,["images"]);return this.http.post(this.apiUrl,r).pipe(i(()=>this.clearCache()))}updateProperty(e,t){let n=t,{images:r}=n,p=s(n,["images"]);return this.http.put(`${this.apiUrl}/${e}`,p).pipe(i(()=>this.clearCache()))}deleteProperty(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(i(()=>this.clearCache()))}uploadPropertyImages(e,t){let r=new FormData;return t.forEach(p=>{r.append("images",p)}),this.http.post(`${this.apiUrl}/${e}/images`,r)}clearCache(){this.featuredPropertiesCache$.next([]),this.propertyCache.clear(),this.cacheExpiry.clear()}static \u0275fac=function(t){return new(t||o)(y(f))};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{g as a};
